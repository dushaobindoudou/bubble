# 🫧 Bubble Brawl 游戏开发任务清单

## 📋 项目概述

基于现有 agar.io 克隆项目，开发 **Bubble Brawl（泡泡大作战）** 多人在线竞技游戏。

### 🎯 开发目标
- 将现有项目改造为可爱的泡泡主题游戏
- 实现加速、喂食等核心游戏机制
- 支持PC端和移动端跨平台游戏
- 提供多种游戏模式和个性化皮肤系统

---

## 🚀 阶段1：项目基础改造

### 1.1 项目环境检查与配置
- [ ] 检查当前项目运行状态，确认所有依赖正常安装
- [ ] 验证游戏可以正常启动（http://localhost:3000）
- [ ] 测试基础多人在线功能是否正常工作
- [ ] 确认开发环境配置完整

### 1.2 项目信息更新
- [ ] 修改 `package.json` 中的项目名称为 "bubble-brawl"
- [ ] 更新项目描述为 "Bubble Brawl - 泡泡大作战多人在线游戏"
- [ ] 更新作者信息和项目仓库地址
- [ ] 修改许可证信息（如需要）

### 1.3 游戏标题与文案更新
- [ ] 更新 `src/client/index.html` 中的页面标题
- [ ] 将所有界面文案从 agar.io 相关替换为泡泡大作战主题
- [ ] 更新游戏说明和操作指南文案
- [ ] 修改错误提示和系统消息文案

### 1.4 泡泡主题配色方案
- [ ] 在 CSS 中定义泡泡主题色彩变量：
  - 泡泡粉: #FFB6C1
  - 海洋蓝: #87CEEB
  - 薄荷绿: #98FB98
  - 柠檬黄: #FFFFE0
  - 薰衣草紫: #DDA0DD
- [ ] 更新背景渐变色为 #667eea → #764ba2
- [ ] 设置可爱的字体样式（Comic Sans MS）

### 1.5 泡泡渲染效果
- [ ] 修改细胞渲染函数，实现泡泡的径向渐变效果
- [ ] 添加泡泡高光效果（左上角白色高光）
- [ ] 实现泡泡边缘柔化和透明度效果
- [ ] 创建不同皮肤的颜色配置函数
- [ ] 优化泡泡名称显示样式

### 1.6 基础UI美化
- [ ] 设计可爱的按钮样式（圆角、渐变、阴影）
- [ ] 美化输入框和选择器样式
- [ ] 添加按钮悬停和点击动画效果
- [ ] 更新图标和装饰元素

---

## ⚡ 阶段2：核心功能开发

### 2.1 加速机制实现
- [ ] 在服务器端实现加速状态管理
- [ ] 设置加速参数：5秒持续时间，2倍速度，10秒冷却
- [ ] 实现加速冷却时间检查
- [ ] 广播加速状态给所有客户端
- [ ] 在客户端显示加速特效

### 2.2 喂食机制实现
- [ ] 实现喂食功能：消耗当前体积的2%
- [ ] 生成食物粒子并添加到地图
- [ ] 设置1秒喂食冷却时间
- [ ] 实现最小体积限制（低于10无法喂食）
- [ ] 添加喂食动画效果

### 2.3 移动端虚拟摇杆
- [ ] 检测移动设备并显示虚拟摇杆
- [ ] 实现摇杆的触摸事件处理
- [ ] 计算摇杆方向和移动向量
- [ ] 优化摇杆的视觉反馈
- [ ] 适配不同屏幕尺寸

### 2.4 移动端技能按钮
- [ ] 添加加速按钮（🚀图标）
- [ ] 添加喂食按钮（🍬图标）
- [ ] 实现按钮的触摸事件
- [ ] 显示技能冷却时间进度
- [ ] 优化按钮布局和大小

### 2.5 游戏平衡性调整
- [ ] 调整初始体积为10
- [ ] 设置最大体积为1000
- [ ] 优化移动速度公式：速度 = 基础速度 × (体积^-0.439)
- [ ] 调整吞噬条件：目标需小于自己80%
- [ ] 平衡能量点数量和分布

### 2.6 吐器机制移除
- [ ] 移除原有的细胞分裂功能
- [ ] 删除相关的键盘绑定（空格键等）
- [ ] 清理分裂相关的服务器逻辑
- [ ] 移除分裂动画和特效
- [ ] 更新操作说明

---

## 🎨 阶段3：UI美化与体验优化

### 3.1 主界面重设计
- [ ] 设计新的游戏启动界面布局
- [ ] 添加昵称输入框和验证
- [ ] 实现皮肤选择下拉菜单
- [ ] 添加游戏模式选择按钮
- [ ] 设计设置和帮助界面

### 3.2 游戏HUD系统
- [ ] 实现实时体积显示
- [ ] 添加当前排名显示
- [ ] 创建实时排行榜（显示前5名）
- [ ] 显示技能冷却时间进度条
- [ ] 添加游戏时间显示（限时模式）

### 3.3 响应式设计
- [ ] 实现移动端和PC端的布局适配
- [ ] 优化不同屏幕尺寸下的UI显示
- [ ] 适配横屏和竖屏模式
- [ ] 调整字体大小和按钮尺寸
- [ ] 测试各种设备的兼容性

### 3.4 动画效果优化
- [ ] 添加泡泡呼吸动画（大小微变）
- [ ] 实现按钮点击和悬停动画
- [ ] 添加技能释放特效
- [ ] 实现死亡爆炸动画
- [ ] 优化界面切换过渡效果

### 3.5 音效系统基础
- [ ] 添加泡泡移动的气泡声
- [ ] 实现吸收能量点的"叮"声
- [ ] 添加吞噬玩家的"咕噜"声
- [ ] 实现技能释放音效
- [ ] 添加背景音乐和音量控制

### 3.6 性能优化
- [ ] 实现对象池减少垃圾回收
- [ ] 优化Canvas渲染性能
- [ ] 减少不必要的重绘操作
- [ ] 优化网络同步频率
- [ ] 监控和优化内存使用

---

## 🌟 阶段4：高级功能与扩展

### 4.1 皮肤系统实现
- [ ] 实现基础皮肤：粉色、蓝色、绿色泡泡
- [ ] 添加主题皮肤：小猫系列（橘猫、黑猫、白猫）
- [ ] 实现宇航系列皮肤（宇航员、火箭、星球）
- [ ] 添加甜品系列皮肤（蛋糕、甜甜圈、棉花糖）
- [ ] 实现皮肤选择和预览功能
- [ ] 添加特效边框（闪电、花瓣、星光等）

### 4.2 地图道具系统
- [ ] 实现冰冻气泡：3秒无法加速
- [ ] 添加隐身药水：8秒不显示体积
- [ ] 实现磁力圈：自动吸收范围内能量点
- [ ] 设置道具刷新机制和位置
- [ ] 添加道具拾取音效和特效

### 4.3 多种游戏模式
- [ ] 实现自由泡泡战（FFA）模式
- [ ] 添加团队泡泡战（红蓝对抗）
- [ ] 实现限时排位战（10分钟）
- [ ] 添加好友自建房功能
- [ ] 实现模式切换和房间管理

### 4.4 排行榜系统
- [ ] 实现实时游戏内排行榜
- [ ] 添加历史最高分数记录
- [ ] 创建成就系统和徽章
- [ ] 实现ELO评级系统
- [ ] 添加数据统计和分析

### 4.5 房间系统
- [ ] 实现房间创建和加入功能
- [ ] 添加房间码分享机制
- [ ] 实现私人房间和密码保护
- [ ] 添加房主权限管理
- [ ] 实现房间设置自定义

### 4.6 社交功能
- [ ] 实现战报卡片生成
- [ ] 添加社交媒体分享功能
- [ ] 创建好友系统基础
- [ ] 实现邀请奖励机制
- [ ] 添加用户反馈系统

### 4.7 Web3钱包集成
- [ ] **4.7.1 Web3技术栈选型与安装**
  - 安装RainbowKit + WAGMI + Ethers.js技术栈
  - 配置基础Web3开发环境
  - 设置TypeScript类型支持
- [ ] **4.7.2 Monad网络配置**
  - 配置Monad Testnet网络参数
  - Chain ID: 10143 (0x279f)
  - RPC端点: https://testnet-rpc.monad.xyz
  - 货币符号: MON
- [ ] **4.7.3 多钱包支持实现**
  - 集成MetaMask钱包连接
  - 支持WalletConnect协议
  - 添加Coinbase Wallet支持
  - 实现钱包自动检测功能
- [ ] **4.7.4 钱包登录UI设计**
  - 设计钱包选择界面
  - 实现连接状态显示
  - 添加钱包切换功能
  - 优化移动端钱包体验
- [ ] **4.7.5 用户身份管理**
  - 实现钱包地址与游戏账户绑定
  - 管理用户登录状态
  - 实现基于钱包的权限控制
  - 添加断线重连机制
- [ ] **4.7.6 网络切换功能**
  - 实现自动切换到Monad网络
  - 处理网络不匹配提示
  - 添加手动网络切换选项
  - 优化网络切换用户体验

### 4.8 智能合约模块
- [ ] **4.8.1 智能合约开发环境搭建**
  - 安装并配置Hardhat开发框架
  - 设置Solidity编译环境
  - 配置测试和部署脚本
  - 集成OpenZeppelin合约库
- [ ] **4.8.2 $BUB代币合约开发**
  - 开发ERC-20标准代币合约
  - 实现代币铸造和销毁功能
  - 添加游戏奖励分发机制
  - 设置代币经济参数
- [ ] **4.8.3 泡泡皮肤NFT合约开发（增强版）**
  - **4.8.3.1 管理员权限系统设计**
    - 使用OpenZeppelin AccessControl实现角色权限控制
    - 定义ADMIN_ROLE和SKIN_MANAGER_ROLE角色
    - 实现多级权限管理和权限转移机制
  - **4.8.3.2 皮肤模板管理系统**
    - 实现createSkinTemplate()函数创建皮肤模板
    - 支持皮肤名称、描述、稀有度等属性配置
    - 添加模板版本控制和历史记录
  - **4.8.3.3 皮肤属性系统实现**
    - 实现特效类型、颜色配置、动画效果属性
    - 支持动态元数据更新和IPFS存储
    - 添加属性验证和约束机制
  - **4.8.3.4 皮肤模板状态管理**
    - 实现皮肤模板的启用/禁用功能
    - 支持批量状态操作和状态查询
    - 添加状态变更事件日志
  - **4.8.3.5 批量铸造功能**
    - 实现批量皮肤创建功能，优化gas消耗
    - 支持一次性铸造多个不同皮肤
    - 添加铸造限制和防重复机制
  - **4.8.3.6 事件日志和NatSpec文档**
    - 添加完整的事件日志记录系统
    - 编写详细的NatSpec文档注释
    - 实现合约接口标准化
- [ ] **4.8.4 合约安全审计**
  - 进行智能合约安全检查
  - 使用Slither等工具进行静态分析
  - 检查重入攻击、溢出等常见漏洞
  - 编写全面的合约测试用例
- [ ] **4.8.5 合约部署与Monad集成**
  - 将合约部署到Monad Testnet
  - 配置合约地址和ABI
  - 实现前端与合约的交互
  - 测试合约功能完整性
- [ ] **4.8.6 代币经济模型设计**
  - 设计$BUB代币获取机制（游戏表现奖励）
  - 实现代币消耗场景（购买皮肤、道具）
  - 建立NFT皮肤交易市场
  - 设计通胀控制和经济平衡机制

- [ ] **4.8.7 项目结构重组**
  - **4.8.7.1 创建合约目录结构**
    - 在项目根目录创建 src/contracts/ 目录
    - 按功能模块组织子目录：nft/、token/、game/、governance/
    - 设置合约文件命名规范和组织标准
  - **4.8.7.2 配置Hardhat项目结构**
    - 更新hardhat.config.js配置文件
    - 设置合约源码路径和编译输出目录
    - 配置网络参数和部署设置
  - **4.8.7.3 创建部署脚本目录**
    - 创建 scripts/ 目录组织部署脚本
    - 分类创建初始化脚本和工具脚本
    - 实现自动化部署流程
  - **4.8.7.4 创建测试文件结构**
    - 创建 test/ 目录按合约类型组织测试文件
    - 设置测试环境和测试工具配置
    - 建立测试数据和模拟环境
  - **4.8.7.5 配置合约编译环境**
    - 配置Solidity编译器版本（0.8.19+）
    - 设置编译优化参数和依赖库
    - 集成OpenZeppelin合约库

- [ ] **4.8.8 地图NFT合约开发**
  - **4.8.8.1 地图NFT合约基础架构**
    - 开发基础ERC-721地图NFT合约
    - 集成OpenZeppelin库和权限控制系统
    - 实现基础铸造和转移功能
  - **4.8.8.2 地图模板管理系统**
    - 实现管理员创建地图模板功能
    - 支持地图尺寸、主题、道具配置等属性
    - 添加地图背景样式和特殊效果配置
  - **4.8.8.3 地图稀有度系统**
    - 实现四级稀有度系统（普通、稀有、史诗、传说）
    - 设计随机铸造机制和概率分布
    - 添加稀有度验证和查询功能
  - **4.8.8.4 地图使用权限管理**
    - 实现地图所有者权限和使用权限分离
    - 支持地图租借机制和使用记录
    - 添加权限转移和授权管理
  - **4.8.8.5 地图属性和元数据**
    - 实现地图属性存储和元数据管理
    - 支持动态属性更新和IPFS存储
    - 添加地图预览和属性查询接口
  - **4.8.8.6 地图NFT测试用例**
    - 编写全面的单元测试覆盖所有功能
    - 测试边界情况和异常处理
    - 实现集成测试和性能测试

---

## 🔧 阶段5：测试与部署

### 5.1 单元测试编写
- [ ] 为碰撞检测算法编写测试
- [ ] 测试移动速度计算函数
- [ ] 验证技能冷却时间逻辑
- [ ] 测试游戏状态同步
- [ ] 验证数据验证和安全检查

### 5.2 集成测试
- [ ] 测试多人在线游戏功能
- [ ] 验证不同游戏模式运行
- [ ] 测试移动端和PC端兼容性
- [ ] 验证房间系统功能
- [ ] 测试皮肤和道具系统

### 5.3 性能优化与压力测试
- [ ] 测试服务器承载能力
- [ ] 优化网络延迟和同步
- [ ] 进行内存泄漏检查
- [ ] 测试高并发场景
- [ ] 优化数据库查询性能

### 5.4 安全性测试
- [ ] 检查输入验证和过滤
- [ ] 防止作弊和外挂
- [ ] 实现API限流保护
- [ ] 验证用户权限控制
- [ ] 检查数据传输安全

### 5.5 生产环境部署
- [ ] 配置Docker容器化
- [ ] 设置CDN静态资源加速
- [ ] 配置域名和HTTPS证书
- [ ] 实现负载均衡
- [ ] 配置数据库和缓存

### 5.6 监控与日志
- [ ] 实现游戏性能监控
- [ ] 收集用户行为数据
- [ ] 设置错误日志和报警
- [ ] 实现数据分析仪表板
- [ ] 配置自动化运维

---

## 📊 开发进度跟踪

### 当前状态
- ✅ 项目迁移完成
- ✅ 基础环境搭建
- ⏳ 准备开始阶段1开发

### 预期时间线
- **阶段1**: 1-2周（基础改造）
- **阶段2**: 2-3周（核心功能）
- **阶段3**: 2-3周（UI优化）
- **阶段4**: 4-6周（高级功能 + Web3集成）
- **阶段5**: 1-2周（测试部署）

### Web3功能时间分配
- **Web3钱包集成**: 1-2周
- **智能合约开发**: 2-3周
- **区块链集成测试**: 1周

### 成功指标
- 游戏可稳定运行，支持20+玩家同时在线
- 移动端和PC端体验流畅
- 核心功能完整实现
- 用户界面美观可爱
- 性能指标达标（<100ms延迟，>30FPS）

---

**最后更新**: 2024年6月19日
**项目状态**: 准备开始开发 🚀
